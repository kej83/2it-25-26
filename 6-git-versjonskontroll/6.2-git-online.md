# Git Del 2: Git i Skyen & Bilde-app med Interface

**Mål:** Lage en nettside hvor brukere kan laste opp bilder, behandle dem med `Sharp`, og bruke Git til å styre utviklingen (Branches og GitHub).
**Teknologi:** Node.js (ES Modules), Express, Multer, Sharp, HTML, Git.

I forrige del lærte du det grunnleggende. Nå skal vi lage noe som faktisk ser ut som en app! Vi skal lage et system der brukeren kan laste opp et bilde i nettleseren, og serveren din fikser bildet.

---

### Steg 1: Oppsett av "Moderne" Node.js

Vi skal bruke den moderne måten å skrive JavaScript på (`import` i stedet for `require`).

1. Lag en mappe på skrivebordet som heter `bilde-app`.
2. Åpne mappen i VS Code.
3. Åpne terminalen (`Ctrl + æ`) og skriv:
```bash
npm init -y

```


4. **Viktig:** Åpne filen `package.json` som nå dukket opp. Finn linjen `"main": "index.js",` og legg til denne linjen rett under:
```json
"type": "module",

```


*(Dette forteller Node.js at vi vil bruke moderne import).*
5. Installer verktøyene vi trenger (Express for server, Sharp for bilder, Multer for opplasting):
```bash
npm install express sharp multer

```


6. Lag filen `.gitignore` og skriv dette i den (så vi ikke laster opp søppel til GitHub):
```text
node_modules
uploads
processed
.DS_Store

```


7. Start Git:
```bash
git init

```



---

### Steg 2: Serveren og HTML-siden (First Commit)

Vi trenger en server og en nettside (HTML) hvor brukeren kan velge bildet sitt.

1. Lag en ny mappe i prosjektet ditt som heter `public`.
2. Inni `public`, lag en fil som heter `index.html`:
```html
<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <title>Min Bilde-fikser</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 50px; }
        form { background: #f0f0f0; padding: 20px; border-radius: 10px; display: inline-block; }
    </style>
</head>
<body>
    <h1>Last opp et bilde</h1>
    <form action="/upload" method="POST" enctype="multipart/form-data">
        <input type="file" name="image" required>
        <br><br>
        <button type="submit">Last opp og fiks bildet!</button>
    </form>
</body>
</html>

```


3. Lag filen `server.js` i hovedmappen (ikke i public) og skriv:
```javascript
import express from 'express';
import multer from 'multer';
import sharp from 'sharp';
import fs from 'fs';

const app = express();
const upload = multer({ dest: 'uploads/' }); // Her lagres bildene midlertidig

// Lagrer vi de ferdige bildene her? Sjekk om mappen finnes, hvis ikke lag den.
if (!fs.existsSync('processed')){
    fs.mkdirSync('processed');
}

// Server HTML-filen og ferdige bilder
app.use(express.static('public'));
app.use('/bilder', express.static('processed'));

app.listen(3000, () => {
    console.log('Server kjører på http://localhost:3000');
});

```


4. Lagre alt. Sjekk at serveren starter (`node server.js`), og gå til `http://localhost:3000` i nettleseren. Du skal se skjemaet ditt! Stopp serveren (`Ctrl + C`).
5. Lagre versjonen i Git:
```bash
git add .
git commit -m "Oppsett av server og HTML interface"

```



---

### Steg 3: Koble til GitHub (Push)

La oss sikre koden i skyen før vi begynner med den vanskelige logikken.

1. Gå til [github.com](https://github.com), logg inn og lag et **New repository**.
2. Kall det `bilde-app-interface`.
3. Følg instruksene på GitHub-skjermen ("...push an existing repository..."). Det ser ca. slik ut (bruk dine egne linjer!):
```bash
git remote add origin https://github.com/DIN-BRUKER/bilde-app-interface.git
git branch -M main
git push -u origin main

```



---

### Steg 4: Få opplastingen til å virke (Bildebehandling)

Nå skal vi koble HTML-skjemaet til `Sharp` slik at bildet faktisk blir behandlet.

1. Åpne `server.js` igjen. Legg til denne koden *før* `app.listen(...)`:
```javascript
// Håndter opplasting
app.post('/upload', upload.single('image'), async (req, res) => {
    try {
        // Filnavnet på det ferdige bildet
        const outputFilename = `fixed-${Date.now()}.jpg`;

        // Bruk Sharp til å endre størrelse
        await sharp(req.file.path)
            .resize(300) // Endre bredden til 300px
            .toFile(`processed/${outputFilename}`);

        // Send tilbake en lenke til bildet
        res.send(`
            <h2>Suksess!</h2>
            <p>Her er bildet ditt i 300px bredde:</p>
            <img src="/bilder/${outputFilename}" />
            <br>
            <a href="/">Prøv igjen</a>
        `);
    } catch (error) {
        console.error(error);
        res.send('Oisann, noe gikk galt med bildet!');
    }
});

```


2. Start serveren (`node server.js`). Last opp et stort bilde.
3. **Resultat:** Du skal få bildet tilbake, ferdig krympet i nettleseren!
4. Lagre endringene i Git og send til GitHub:
```bash
git add .
git commit -m "La til opplasting og resize med Sharp"
git push

```



---

### Steg 5: "Feature Branching" (Svart/Hvitt filter)

Kunden ringer! De vil at bildene skal bli **Svart/Hvitt** i tillegg til å bli mindre.
Dette er en ny "feature", så vi lager en egen **Branch** for å ikke ødelegge koden som allerede virker.

1. Lag en ny branch:
```bash
git checkout -b bw-feature

```


2. Endre koden i `server.js`. Legg til `.grayscale()`:
```javascript
// ... inne i app.post ...
        await sharp(req.file.path)
            .resize(300)
            .grayscale() // <-- NYTT FILTER HER
            .toFile(`processed/${outputFilename}`);
// ...

```


3. Test koden! Last opp et fargebilde og se om det blir grått.
4. Hvis det virker, lagre til Git (merk at dette nå lagres i *bw-feature* branchen):
```bash
git add .
git commit -m "La til grayscale filter"

```



---

### Steg 6: Merge (Slå sammen og fullfør)

Vi er fornøyde med filteret. Nå skal vi flette det inn i hovedprogrammet.

1. Gå tilbake til hovedsporet:
```bash
git checkout main

```


*(Hvis du tester appen nå, vil du se at den er tilbake til farger – magisk!)*
2. Slå sammen (merge) branchen din inn i main:
```bash
git merge bw-feature

```


3. Send den ferdige appen til GitHub:
```bash
git push

```



---

### Oppsummering: Hva har du lært?

Du har nå bygget en full-stack applikasjon!

1. **Backend:** Du bruker `import express` (ES Modules) for å kjøre serveren.
2. **Frontend:** Du laget et HTML-skjema med `multipart/form-data` for å sende filer.
3. **Logikk:** Du brukte `multer` til å ta imot filen, og `sharp` til å behandle den.
4. **Git:** Du utviklet en ny funksjon i en trygg "branch" før du flettet den inn i hovedkoden.

**Tips til videre utforskning:**
Prøv å endre `.grayscale()` til `.blur(5)` eller `.rotate(180)` i Sharp-koden for å se hva som skjer!